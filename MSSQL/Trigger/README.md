#### TRIGGER

```sql
/* TRIGGERS */


CREATE TABLE PRODUTOS(
	IDPRODUTO INT IDENTITY PRIMARY KEY,
	NOME VARCHAR(50) NOT NULL,
	CATEGORIA VARCHAR(30) NOT NULL,
	PRECO NUMERIC(10,2) NOT NULL
)
GO

CREATE TABLE HISTORICO(
	IDOPERACAO INT PRIMARY KEY IDENTITY,
	PRODUTO VARCHAR(50) NOT NULL,
	CATEGORIA VARCHAR(30) NOT NULL,
	PRECOANTIGO NUMERIC(10,2) NOT NULL,
	PRECONOVO NUMERIC(10,2) NOT NULL,
	DATA DATETIME,
	USUARIO VARCHAR(30),
	MENSAGEM VARCHAR(100)
)
GO

INSERT INTO PRODUTOS VALUES('LIVRO SQL SERVER','LIVROS',98.00)
INSERT INTO PRODUTOS VALUES('LIVRO ORACLE','LIVROS',50.00)
INSERT INTO PRODUTOS VALUES('LICENÃ‡A POWERCENTER','SOFTWARES',45000.00)
INSERT INTO PRODUTOS VALUES('NOTEBOOK I7','COMPUTADORES',3150.00)
INSERT INTO PRODUTOS VALUES('LIVRO BUSINESS INTELLIGENCE','LIVROS',90.00)
GO

SELECT * FROM PRODUTOS
SELECT * FROM HISTORICO
GO

/* TRIGGER DE DADOS - DATA MANUPULATION LANGUAGE */
CREATE TRIGGER TRG_ATUALIZA_PRECO
ON DBO.PRODUTOS
FOR UPDATE
AS
			DECLARE @IDPRODUTO INT
			DECLARE @PRODUTO VARCHAR(30)
			DECLARE @CATEGORIA VARCHAR(10)
			DECLARE @PRECO NUMERIC(10,2)
			DECLARE @PRECONOVO NUMERIC(10,2)
			DECLARE @DATA DATETIME
			DECLARE @USUARIO VARCHAR(30)
			DECLARE @ACAO VARCHAR(100)

			SELECT @IDPRODUTO = IDPRODUTO FROM INSERTED
			SELECT @PRODUTO = NOME FROM INSERTED
			SELECT @CATEGORIA = CATEGORIA FROM INSERTED
			SELECT @PRECO = PRECO FROM DELETED
			SELECT @PRECONOVO = PRECO FROM INSERTED

			SET @DATA = GETDATE()
			SET @USUARIO = SUSER_NAME()
			SET @ACAO = 'VALOR INSERIDO PELA TRIGGER TRG_ATUALIZA_PRECO'

			INSERT INTO HISTORICO
			(PRODUTO,CATEGORIA,PRECOANTIGO,PRECONOVO,DATA,USUARIO,MENSAGEM)
			VALUES
			(@PRODUTO,@CATEGORIA,@PRECO, @PRECONOVO,@DATA, @USUARIO,@ACAO)

			PRINT 'TRIGGER EXECULTADA COM SUCESSO'
GO

```
